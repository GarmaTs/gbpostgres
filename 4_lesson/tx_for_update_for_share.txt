Транзакции. FOR UPDATE, FOR SHARE
Используя FOR UPDATE или FOR SHARE в запросе, можно указать базе, что 
изменять выбранные строки нельзя, пока текущая транзакция не завершится.
BEGIN;
SELECT * FROM purchases WHERE processed = false FOR UPDATE;
-- * обработка выбранных строк на стороне приложения *
UPDATE purchases SET ...;
COMMIT;

FOR UPDATE ~ mutex.Lock (во время транзакции доступ к данным заблокирован 
полностью если второй запрос указал FOR UPDATE/SHARE, простой запрос на 
чтение выполнится)
FOR SHARE ~ mutex.RWLock (во время транзакции данные доступны только для 
чтения если второй запрос указал FOR SHARE, если во втором запросе указано
FOR UPDATE, то он не будет выполнен пока не закончится первая транзакция)